

<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Next.js CLI - River&#39;s Blog</title><meta name="Description" content=""><meta property="og:title" content="Next.js CLI" />
<meta property="og:description" content="什么是 Next." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cuiyulu.me/posts/nextjs-cli/" /><meta property="og:image" content="https://cuiyulu.me/posts/nextjs-cli/featured.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-15T00:00:00+00:00" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cuiyulu.me/posts/nextjs-cli/featured.png"/>
<meta name="twitter:title" content="Next.js CLI"/>
<meta name="twitter:description" content="什么是 Next."/>
<meta name="application-name" content="River&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="River&#39;s Blog">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="canonical" href="https://cuiyulu.me/posts/nextjs-cli/" /><link rel="prev" href="https://cuiyulu.me/posts/https-for-local-development/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Next.js CLI",
        "inLanguage": "zh-cn",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://cuiyulu.me/posts/nextjs-cli/"
        },"genre": "posts","keywords": "Next.js, React","wordcount":  745 ,
        "url": "https://cuiyulu.me/posts/nextjs-cli/","datePublished": "2024-01-15T00:00:00+00:00","dateModified": "2024-01-15T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "River"},"author": {
                "@type": "Person",
                "name": "River"
            },"description": ""
    }
    </script></head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="River&#39;s Blog">River&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item active" href="/posts/" title="Posts"> 博客 </a><a class="menu-item" href="/"> 书影音 </a><a class="menu-item" href="/categories/" title="Categories"> 分类 </a><a class="menu-item" href="/tags/" title="Tags"> 标签 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="选择语言">Chinese<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" title="选择语言" id="language-select-desktop" onchange="location = this.value;"><option value="/posts/nextjs-cli/" selected>Chinese</option></select>
                    </a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="River&#39;s Blog">River&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="Posts">博客</a><a class="menu-item" href="/" title="">书影音</a><a class="menu-item" href="/categories/" title="Categories">分类</a><a class="menu-item" href="/tags/" title="Tags">标签</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">Chinese<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" title="选择语言" onchange="location = this.value;"><option value="/posts/nextjs-cli/" selected>Chinese</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#创建一个-next-app">创建一个 Next app</a>
      <ul>
        <li><a href="#1-自动创建">1. 自动创建</a></li>
        <li><a href="#2-手动创建">2. 手动创建</a></li>
      </ul>
    </li>
    <li><a href="#nextjs-cli">Next.js CLI</a>
      <ul>
        <li><a href="#build-构建">Build 构建</a>
          <ul>
            <li><a href="#next-build"><code>next build</code></a></li>
            <li><a href="#next-build---profile"><code>next build --profile</code></a></li>
            <li><a href="#next-build---debug"><code>next build --debug</code></a></li>
          </ul>
        </li>
        <li><a href="#development-开发模式">Development 开发模式</a>
          <ul>
            <li><a href="#next-dev"><code>next dev</code></a></li>
            <li><a href="#本地开发配置-https">本地开发配置 HTTPS</a></li>
          </ul>
        </li>
        <li><a href="#production-生产模式">Production 生产模式</a></li>
        <li><a href="#lint-代码质量检查">Lint 代码质量检查</a></li>
        <li><a href="#info-系统信息">Info 系统信息</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Next.js CLI</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">River</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-series">系列 <a href="/series/next.js/"><i class="far fa-list-alt fa-fw"></i>Next.js</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-01-15">2024-01-15</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2024-01-15">2024-01-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 745 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#创建一个-next-app">创建一个 Next app</a>
      <ul>
        <li><a href="#1-自动创建">1. 自动创建</a></li>
        <li><a href="#2-手动创建">2. 手动创建</a></li>
      </ul>
    </li>
    <li><a href="#nextjs-cli">Next.js CLI</a>
      <ul>
        <li><a href="#build-构建">Build 构建</a>
          <ul>
            <li><a href="#next-build"><code>next build</code></a></li>
            <li><a href="#next-build---profile"><code>next build --profile</code></a></li>
            <li><a href="#next-build---debug"><code>next build --debug</code></a></li>
          </ul>
        </li>
        <li><a href="#development-开发模式">Development 开发模式</a>
          <ul>
            <li><a href="#next-dev"><code>next dev</code></a></li>
            <li><a href="#本地开发配置-https">本地开发配置 HTTPS</a></li>
          </ul>
        </li>
        <li><a href="#production-生产模式">Production 生产模式</a></li>
        <li><a href="#lint-代码质量检查">Lint 代码质量检查</a></li>
        <li><a href="#info-系统信息">Info 系统信息</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><div class="details admonition question open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-question-circle fa-fw"></i>什么是 Next.js<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><a href="https://nextjs.org" target="_blank" rel="noopener noreferrer">Next.js</a> 是基于  <code>Node.js</code> 和 <code>React</code> 的 Web 开发框架，集成了基于 <code>Rust</code> 的 <code>JavaScript</code> 工具，可以快速创建<strong>全栈应用</strong>。</div>
        </div>
    </div>
<div class="details admonition question open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-question-circle fa-fw"></i>什么是 Next.js CLI<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p><strong>CLI</strong> (Command Line Interface) 即命令行界面，是一种用<strong>文本命令</strong>与计算机系统<strong>交互</strong>的方式，用户可以通过在终端输入特定命令来执行操作。</p>
<p><a href="https://nextjs.org/docs/pages/api-reference/next-cli" target="_blank" rel="noopener noreferrer">Next.js CLI</a> 是用来帮助用户启动、构建和导出应用程序的，是我们开发中常用到的命令行。</p>
</div>
        </div>
    </div></p>
<p>不过在讲 Next.js CLI 之前，我们先来创建一个演示项目吧！</p>
<h2 id="创建一个-next-app" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-next-app" class="header-mark"></a>创建一个 Next app</h2><h3 id="1-自动创建" class="headerLink">
    <a href="#1-%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%ba" class="header-mark"></a>1. 自动创建</h3><p>打开终端，执行下方命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx create-next-app@latest
</span></span></code></pre></div><p>执行上面这行命令后，需要去选择下方的这些配置，作为一个演示项目，全部选择默认选项即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">What is your project named?  my-app
</span></span><span class="line"><span class="cl">Would you like to use TypeScript?  No / Yes
</span></span><span class="line"><span class="cl">Would you like to use ESLint?  No / Yes
</span></span><span class="line"><span class="cl">Would you like to use Tailwind CSS?  No / Yes
</span></span><span class="line"><span class="cl">Would you like to use <span class="sb">`</span>src/<span class="sb">`</span> directory?  No / Yes
</span></span><span class="line"><span class="cl">Would you like to use App Router? <span class="o">(</span>recommended<span class="o">)</span>  No / Yes
</span></span><span class="line"><span class="cl">Would you like to customize the default import <span class="nb">alias</span> <span class="o">(</span>@/*<span class="o">)</span>?  No / Yes
</span></span></code></pre></div><p>回答完上面这些 prompts，就会根据你刚刚的配置自动的生成一个新的项目。</p>
<hr>
<p>除了上面这种<strong>交互式</strong>的选择方式，我们也可以通过传递命令行参数，从而以<strong>非交互式</strong>的途径去创建一个新项目。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">// 查看构建项目时可用的命令行参数
</span></span><span class="line"><span class="cl">npx create-next-app --help
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 打印如下
</span></span><span class="line"><span class="cl">Usage: create-next-app &lt;project-directory&gt; <span class="o">[</span>options<span class="o">]</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">Options:
</span></span><span class="line"><span class="cl">  -V, --version                        output the version number
</span></span><span class="line"><span class="cl">  --ts, --typescript
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize as a TypeScript project. <span class="o">(</span>default<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --js, --javascript
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize as a JavaScript project.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --tailwind
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize with Tailwind CSS config. <span class="o">(</span>default<span class="o">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --eslint
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize with ESLint config.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --app
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize as an App Router project.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --src-dir
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Initialize inside a <span class="sb">`</span>src/<span class="sb">`</span> directory.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --import-alias &lt;alias-to-configure&gt;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Specify import <span class="nb">alias</span> to use <span class="o">(</span>default <span class="s2">&#34;@/*&#34;</span><span class="o">)</span>.
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --use-npm
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Explicitly tell the CLI to bootstrap the app using npm
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --use-pnpm
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Explicitly tell the CLI to bootstrap the app using pnpm
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --use-yarn
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Explicitly tell the CLI to bootstrap the app using Yarn
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --use-bun
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Explicitly tell the CLI to bootstrap the app using Bun
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  -e, --example <span class="o">[</span>name<span class="o">]</span><span class="p">|</span><span class="o">[</span>github-url<span class="o">]</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    An example to bootstrap the app with. You can use an example name
</span></span><span class="line"><span class="cl">    from the official Next.js repo or a public GitHub URL. The URL can use
</span></span><span class="line"><span class="cl">    any branch and/or subdirectory
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --example-path &lt;path-to-example&gt;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    In a rare <span class="k">case</span>, your GitHub URL might contain a branch name with
</span></span><span class="line"><span class="cl">    a slash <span class="o">(</span>e.g. bug/fix-1<span class="o">)</span> and the path to the example <span class="o">(</span>e.g. foo/bar<span class="o">)</span>.
</span></span><span class="line"><span class="cl">    In this <span class="k">case</span>, you must specify the path to the example separately:
</span></span><span class="line"><span class="cl">    --example-path foo/bar
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  --reset-preferences
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    Explicitly tell the CLI to reset any stored preferences
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">  -h, --help                           output usage information
</span></span></code></pre></div><p>以 <code>-e, --example</code> 参数为例说一下如何使用：</p>
<p>Next.js 提供了丰富的<a href="https://github.com/vercel/next.js/tree/canary/examples" target="_blank" rel="noopener noreferrer">示例代码</a>，例如 <code>with-redux</code>、<code>api-routers-cors</code>、<code>with-electron</code>、<code>with-jest</code>、<code>with-markdown</code>、<code>with-material-ui</code>、<code>with-mobx</code>，这些代码演示了 Next.js 的各种使用场景，能够让我们快速学习上手。</p>
<p>比如你想查看 <code>with-redux</code> 的使用方法，无需去 clone 代码，直接在创建项目的时候使用 <code>--example</code> 即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx create-next-app --example with-redux your-app-name
</span></span></code></pre></div><figure><a class="lightgallery" href="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png" title="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png" data-thumbnail="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png" data-sub-html="<h2>官方 with-redux demo</h2>">
        <img
            
            loading="lazy"
            src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png"
            srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png 2x"
            sizes="auto"
            alt="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401092224194.png">
    </a><figcaption class="image-caption">官方 with-redux demo</figcaption>
    </figure>
<h3 id="2-手动创建" class="headerLink">
    <a href="#2-%e6%89%8b%e5%8a%a8%e5%88%9b%e5%bb%ba" class="header-mark"></a>2. 手动创建</h3><p>你也可以选择手动创建项目：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npm install next@latest react@latest react-dom@latest
</span></span></code></pre></div><p>npm 会自动创建 <code>package.json</code> 文件并且安装依赖项，但你还需要手动添加 <code>scripts</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="c1">// package.json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dev&#34;</span><span class="p">:</span> <span class="s2">&#34;next dev&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;next build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;next start&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;lint&#34;</span><span class="p">:</span> <span class="s2">&#34;next lint&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>技巧<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">如果是全新的项目，推荐<strong>自动创建方式</strong>。如果是项目中引入 Next.js，可以参考手动创建方式。</div>
        </div>
    </div>
<h2 id="nextjs-cli" class="headerLink">
    <a href="#nextjs-cli" class="header-mark"></a>Next.js CLI</h2><p>我们在文章的开头讲过了 Next.js CLI 是什么，至于 Next.js CLI 到底有哪些命令，可以通过 <code>npx next --help</code> 快速查看命令列表：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">Usage
</span></span><span class="line"><span class="cl">      $ next &lt;command&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Available commands
</span></span><span class="line"><span class="cl">      build, start, export, dev, lint, telemetry, info, experimental-compile, experimental-generate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Options
</span></span><span class="line"><span class="cl">      --version, -v   Version number
</span></span><span class="line"><span class="cl">      --help, -h      Displays this message
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    For more information run a <span class="nb">command</span> with the --help flag
</span></span><span class="line"><span class="cl">      $ next build --help
</span></span></code></pre></div><h3 id="build-构建" class="headerLink">
    <a href="#build-%e6%9e%84%e5%bb%ba" class="header-mark"></a>Build 构建</h3><h4 id="next-build" class="headerLink">
    <a href="#next-build" class="header-mark"></a><code>next build</code></h4><p>执行 <code>next build</code> 会创建项目<strong>生产优化版本</strong>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx next build
</span></span></code></pre></div><p>构建时会输出每条路由的信息，如下图所示：</p>
<p><figure><img
        
        loading="lazy"
        src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401101552921.png"
        srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401101552921.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401101552921.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401101552921.png 2x"
        sizes="auto"
        alt="next build output"
        title="next build output" ></figure></p>
<p>可以看到，每条路由对应两条数据，分别是 <code>Size</code> 和 <code>First Load JS</code>。</p>
<ul>
<li><code>Size</code> 表示目标路由单独依赖项的 JS 大小。</li>
<li><code>First Load JS</code> 表示加载目标路由一共所需的 JS 大小。</li>
</ul>
<p>也许你已经注意到，上图中还有一项数据 <code>First Load JS shared by all</code>，是指每个路由都需要依赖的 JS 大小。也就是说 <code>Size</code>+<code>First Load JS shared by all</code>=<code>First Load JS</code>。</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>注意<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">这些值都是 gzip 压缩后的大小，<code>First Load JS</code> 会用绿色、黄色和红色来表示，<strong>绿色代表着高性能</strong>，黄色和红色则需要优化。</div>
        </div>
    </div>
<h4 id="next-build---profile" class="headerLink">
    <a href="#next-build---profile" class="header-mark"></a><code>next build --profile</code></h4><p>这个命令用于开启 React 的<strong>生产性能分析</strong>（需要 Next.js v9.5 以上）。在使用这个功能前，先为你的浏览器安装 <a href="https://chromewebstore.google.com/detail/react-developer-tools" target="_blank" rel="noopener noreferrer">React 开发者工具</a>。</p>
<blockquote>
<p><code>Profiler</code> 是 React 中测量渲染性能的 API，你可以<a href="https://react.dev/reference/react/Profiler" target="_blank" rel="noopener noreferrer">点击此处</a>了解更多。</p>
</blockquote>
<p>修改 <code>page.js</code> 添加 Profiler Component:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Page</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">Profiler</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;Hello&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">World</span><span class="o">!&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/React.Profiler&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在终端执行 <code>npm run dev</code>，可以在浏览器控制台看到：
<figure><img
        
        loading="lazy"
        src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131005879.png"
        srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131005879.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131005879.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131005879.png 2x"
        sizes="auto"
        alt="React Developer Tools Profiler"
        title="React Developer Tools Profiler" ></figure></p>
<p>但是执行 <code>npm run build</code> 和 <code>npm run start</code>，浏览器控制台查看会提示 —— 不支持 <code>profiling</code>。
<figure><img
        
        loading="lazy"
        src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131033233.png"
        srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131033233.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131033233.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131033233.png 2x"
        sizes="auto"
        alt="React Developer Tools Profiler"
        title="React Developer Tools Profiler" ></figure></p>
<p>这是因为 Profiler 需要 React v16.5+ 的开发模式或者 <code>profiling build</code>。这需要我们在构建的时候加上 <code>--profile</code>，所以执行 <code>npx next build --profile</code> 和 <code>npm run start</code> 再试一次：</p>
<p><figure><img
        
        loading="lazy"
        src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131043860.png"
        srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131043860.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131043860.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401131043860.png 2x"
        sizes="auto"
        alt="React Developer Tools Profiler"
        title="React Developer Tools Profiler" ></figure></p>
<div id="id-1">可以看到 Profiler 已经正常运行了，<strong>这个功能可以帮助我们排查线上的性能问题</strong>。</div>
<h4 id="next-build---debug" class="headerLink">
    <a href="#next-build---debug" class="header-mark"></a><code>next build --debug</code></h4><p>使用这个参数获取更详细的构建输出，比如 <code>rewrites</code>、<code>redirect</code>、<code>headers</code>。</p>
<p>修改 <code>next.config.js</code>，添加 <code>redirects</code> 重定向和 <code>rewrites</code> 重写：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/** @type {import(&#39;next&#39;).NextConfig} */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">nextConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reactStrictMode</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">redirects</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">source</span><span class="o">:</span> <span class="s1">&#39;/index&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">destination</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">permanent</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">rewrites</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">source</span><span class="o">:</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">destination</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">nextConfig</span>
</span></span></code></pre></div><p>执行 <code>npx next build --debug</code>，输出结果如下：
<figure><img
        
        loading="lazy"
        src="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png"
        srcset="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png 1.5x, https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png 2x"
        sizes="auto"
        alt="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png"
        title="https://cyl-blog-image.oss-cn-shenzhen.aliyuncs.com/img/202401161159531.png" ></figure></p>
<p>可以看到，输出信息多了 <code>redirects</code> 和 <code>rewrites</code> 的内容。</p>
<h3 id="development-开发模式" class="headerLink">
    <a href="#development-%e5%bc%80%e5%8f%91%e6%a8%a1%e5%bc%8f" class="header-mark"></a>Development 开发模式</h3><h4 id="next-dev" class="headerLink">
    <a href="#next-dev" class="header-mark"></a><code>next dev</code></h4><p><code>next dev</code> 在开发模式下启动应用程序，包括热加载、错误报告等功能。</p>
<p>应用默认在 http://localhost:3000 启动，也可以使用 <code>-p</code> 来修改默认端口，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx next dev -p <span class="m">4000</span>
</span></span></code></pre></div><p>你也可以修改主机名(hostname)取代默认的 <code>0.0.0.0</code>，以便其他设备访问，使用 <code>-H</code> 来修改 hostname，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx next dev -H 192.168.1.2
</span></span></code></pre></div><h4 id="本地开发配置-https" class="headerLink">
    <a href="#%e6%9c%ac%e5%9c%b0%e5%bc%80%e5%8f%91%e9%85%8d%e7%bd%ae-https" class="header-mark"></a>本地开发配置 HTTPS</h4><p>有某些用例比如 webhooks 或者身份验证，浏览器出于安全考虑要求使用 HTTPS，<code>next.js</code> 可以使用 <code>next dev</code> 生成自签名证书，如下所示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">next dev --experimental-https
</span></span></code></pre></div><p>也可以提供自定义证书和密钥：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">next dev --experimental-https --experimental-https-key ./certificates/localhost-key.pem --experimental-https-cert ./certificates/localhost.pem
</span></span></code></pre></div><div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>注意<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><code>next dev --experimental-https</code> 只是用 <code>mkcert</code> 创建一个用于开发模式的本地受信任证书，在生产环境中，需要使用受信任机构办法的证书。当然如果你在 <code>Vercel</code> 上部署，<code>Vercel</code> 会自动为你配置 Next.js 应用。</div>
        </div>
    </div>
<p>在写这篇文章之前，我也遇到过要求 HTTPS 的场景（浏览器需要调用相机权限），并且专门写了文章介绍如何 <a href="../https-for-local-development/" rel="">为本地开发服务器配置 HTTPS</a>。</p>
<h3 id="production-生产模式" class="headerLink">
    <a href="#production-%e7%94%9f%e4%ba%a7%e6%a8%a1%e5%bc%8f" class="header-mark"></a>Production 生产模式</h3><p><code>next start</code> 以生产模式启动应用程序，应用需要先使用 <code>next build</code> 编译。</p>
<p>应用默认在 http://localhost:3000 启动，可以通过 <code>-p</code> 修改端口号，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx next start -p <span class="m">4000</span>
</span></span></code></pre></div><h3 id="lint-代码质量检查" class="headerLink">
    <a href="#lint-%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e6%a3%80%e6%9f%a5" class="header-mark"></a>Lint 代码质量检查</h3><p><code>next lint</code> 为<code>pages/</code>、<code>app/</code>、<code>components/</code>、<code>lib/</code>和<code>src/</code> 目录下的所有的文件运行 ESlint。</p>
<p>如果你还有其他文件夹要进行代码检查，可以通过 <code>--dir</code> 指定文件夹：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">npx next lint --dir utils
</span></span></code></pre></div><h3 id="info-系统信息" class="headerLink">
    <a href="#info-%e7%b3%bb%e7%bb%9f%e4%bf%a1%e6%81%af" class="header-mark"></a>Info 系统信息</h3><p><code>next info</code> 打印关于当前系统的相关详情，用于报告 Next.js 的 bug。</p>
<p>在项目根目录运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Bash" data-lang="Bash"><span class="line"><span class="cl">next info
</span></span></code></pre></div><p>会得到类似的信息：</p>
<pre tabindex="0"><code>Operating System:
  Platform: linux
  Arch: x64
  Version: #22-Ubuntu SMP Fri Nov 5 13:21:36 UTC 2021
Binaries:
  Node: 16.13.0
  npm: 8.1.0
  Yarn: 1.22.17
  pnpm: 6.24.2
Relevant packages:
  next: 12.0.8
  react: 17.0.2
  react-dom: 17.0.2
</code></pre><p>然后将此信息粘贴到GitHub问题中，以供官方人员进行问题排查。</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-01-15</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/next.js/">Next.js</a>,&nbsp;<a href="/tags/react/">React</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/https-for-local-development/" class="prev" rel="prev" title="为本地开发服务器配置 HTTPS 协议"><i class="fas fa-angle-left fa-fw"></i>为本地开发服务器配置 HTTPS 协议</a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.119.0">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">River</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/css/96ecfc.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>
